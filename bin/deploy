#!/bin/bash
set -euo pipefail

# Responsible for building and spinning up docker containers

echo Using Commit $1

targetfolder=~/blog/builds/$1
cd $targetfolder

# Load the production vars into environment
export $(grep -v '^#' .env.prod | xargs)

# Fire up new containers
docker-compose --project-name blog \
               --file docker-compose.prod.yml \
               up \
               --build \
               --detach

# Cleanup
# docker container prune --force
docker image prune --force
rm -rf $targetfolder
